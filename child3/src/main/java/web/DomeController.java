package web;/** * Created by yuntian on 2019/2/26. */import com.wordnik.swagger.annotations.Api;import com.wordnik.swagger.annotations.ApiOperation;import entity.ResponseMsg;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.servlet.ModelAndView;import service.DomeService;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.lang.reflect.Method;import java.net.InetAddress;import java.util.List;@Controller@Api("活动报名")public class DomeController {    @Autowired    private DomeService domeService;    @RequestMapping(value = "/api/getNameAndPassword",method = RequestMethod.GET)    @ResponseBody    @ApiOperation("查询所有用户")    public ResponseMsg index(//            @RequestBody ResponseMsg aa            HttpServletRequest request,HttpServletResponse response    ){        // 设置：Access-Control-Allow-Origin头，处理Session问题        response.setHeader("Access-Control-Allow-Origin", request.getHeader("Origin"));        response.setHeader("Access-Control-Allow-Credentials", "true");        response.setHeader("P3P", "CP=CAO PSA OUR");        if (request.getHeader("Access-Control-Request-Method") != null && "OPTIONS".equals(request.getMethod())) {            response.addHeader("Access-Control-Allow-Methods", "POST,GET,TRACE,OPTIONS");            response.addHeader("Access-Control-Allow-Headers", "Content-Type,Origin,Accept");            response.addHeader("Access-Control-Max-Age", "120");        }        try {            InetAddress address = InetAddress.getLocalHost();//获取的是本地的IP地址 //PC-20140317PXKX/192.168.0.121            String hostAddress = address.getHostAddress();//192.168.0.121            System.out.println("当前主机："+hostAddress);        }catch (Exception ex){        }        ResponseMsg msg=new ResponseMsg();        System.out.println("客户端："+getIP(request));        List list=domeService.index();        msg.setData(list);        return msg;    }    public String getIP(HttpServletRequest request){        String ip="127.0.0.1";        ip=request.getHeader("x-forwarded-for");        if(ip==null || ip.length()==0 || "unknown".equalsIgnoreCase(ip)){            ip=request.getHeader("Proxy-Client-IP");        }        if(ip==null || ip.length()==0 || "unknown".equalsIgnoreCase(ip)){            ip=request.getHeader("WL-Proxy-Client-IP");        }        if(ip==null || ip.length()==0 || "unknown".equalsIgnoreCase(ip)){            ip=request.getHeader("X-Real-IP");        }        if(ip==null || ip.length()==0 || "unknown".equalsIgnoreCase(ip)){            ip=request.getRemoteAddr();        }        return ip;    }}